/**
 * Translations Module
 * Supported languages: Russian (ru), English (en)
 */

const translations = {
  ru: {
    auth: {
      login: "ÐÐ²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ",
      email: "Ð­Ð»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð°Ñ Ð¿Ð¾Ñ‡Ñ‚Ð°",
      password: "ÐŸÐ°Ñ€Ð¾Ð»ÑŒ",
      loginButton: "Ð’Ð¾Ð¹Ñ‚Ð¸",
      noAccount: "ÐÐµÑ‚ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð°?",
      register: "Ð—Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ",
      forgotPassword: "Ð—Ð°Ð±Ñ‹Ð»Ð¸ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ?",
      restore: "Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ"
    },
    registration: {
      title: "Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ",
      username: "Ð˜Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ",
      email: "Ð­Ð»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð°Ñ Ð¿Ð¾Ñ‡Ñ‚Ð°",
      password: "ÐŸÐ°Ñ€Ð¾Ð»ÑŒ (Ð½Ðµ Ð¼ÐµÐ½ÐµÐµ 8 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²)",
      confirmPassword: "ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ€Ð¾Ð»Ñ",
      createAccount: "Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚",
      haveAccount: "Ð£Ð¶Ðµ ÐµÑÑ‚ÑŒ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚?",
      login: "Ð’Ð¾Ð¹Ñ‚Ð¸"
    },
    resetPassword: {
      title: "Ð—Ð°Ð±Ñ‹Ð»Ð¸ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ?",
      description: "ÐÐµ Ð±ÐµÐ´Ð°! Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÑÐ²Ð¾ÑŽ ÑÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½ÑƒÑŽ Ð¿Ð¾Ñ‡Ñ‚Ñƒ, Ð¸ Ð¼Ñ‹ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð¼ Ð²Ð°Ð¼ Ð¿Ð¸ÑÑŒÐ¼Ð¾ Ð´Ð»Ñ ÑÐ±Ñ€Ð¾ÑÐ° Ð¿Ð°Ñ€Ð¾Ð»Ñ.",
      email: "Ð­Ð»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð°Ñ Ð¿Ð¾Ñ‡Ñ‚Ð°",
      getCode: "ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÐºÐ¾Ð´",
      rememberPassword: "ÐŸÐ¾Ð¼Ð½Ð¸Ñ‚Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ?",
      login: "Ð’Ð¾Ð¹Ñ‚Ð¸",
      success: "ÐŸÐ¸ÑÑŒÐ¼Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾!"
    },
    newPassword: {
      title: "Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ",
      description: "ÐŸÑ€Ð¸Ð´ÑƒÐ¼Ð°Ð¹Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð²Ð°ÑˆÐµÐ¼Ñƒ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ñƒ.",
      newPassword: "Ð½Ðµ Ð¼ÐµÐ½ÐµÐµ 8 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²",
      confirmPassword: "Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ",
      restore: "Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ",
      cancel: "ÐžÑ‚Ð¼ÐµÐ½Ð°",
      haveAccount: "Ð£Ð¶Ðµ ÐµÑÑ‚ÑŒ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚?",
      login: "Ð’Ð¾Ð¹Ñ‚Ð¸",
      success: "ÐŸÐ°Ñ€Ð¾Ð»ÑŒ Ð¸Ð·Ð¼ÐµÐ½Ñ‘Ð½",
      successMessage: "Ð’Ð°Ñˆ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ð±Ñ‹Ð» ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¸Ð·Ð¼ÐµÐ½Ñ‘Ð½.",
      goToAuth: "ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ðº Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸"
    },
    main: {
      hello: "ÐŸÑ€Ð¸Ð²ÐµÑ‚",
      yourQR: "Ð’Ð°Ñˆ QR-ÐºÐ¾Ð´",
      noPoints: "Ð£ Ð²Ð°Ñ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚ Ð½Ð°ÐºÐ¾Ð¿Ð»ÐµÐ½Ð½Ñ‹Ñ… Ð±Ð°Ð»Ð»Ð¾Ð²",
      lastUpdate: "ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÐµÐµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ",
      rewards: "ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ Ð½Ð°Ð³Ñ€Ð°Ð´",
      of: "Ð¸Ð·",
      congratulations: "ÐŸÐ¾Ð·Ð´Ñ€Ð°Ð²Ð»ÑÐµÐ¼! ðŸŽ‰",
      rewardReceived: "Ð’Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»Ð¸ Ð½Ð°Ð³Ñ€Ð°Ð´Ñƒ Ð² {cafe}!",
      great: "Ð¡ÑƒÐ¿ÐµÑ€!"
    },
    menu: {
      main: "Ð“Ð»Ð°Ð²Ð½Ð°Ñ",
      settings: "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸",
      logout: "Ð’Ñ‹Ð¹Ñ‚Ð¸"
    },
    settings: {
      title: "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸",
      profile: "ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ",
      changePassword: "Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ",
      deleteAccount: "Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚",
      language: "Ð¯Ð·Ñ‹Ðº",
      emailLabel: "Email",
      noEmail: "ÐÐµÑ‚ email",
      changeEmail: "Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ email",
      deleteConfirm: "Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚?",
      deleteWarning: "Ð’ÑÐµ Ð²Ð°ÑˆÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð±ÑƒÐ´ÑƒÑ‚ Ð±ÐµÐ·Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð½Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½Ñ‹. Ð­Ñ‚Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð½ÐµÐ»ÑŒÐ·Ñ Ð¾Ñ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ.",
      appearance: "Ð’Ð½ÐµÑˆÐ½Ð¸Ð¹ Ð²Ð¸Ð´",
      darkTheme: "Ð¢Ñ‘Ð¼Ð½Ð°Ñ Ñ‚ÐµÐ¼Ð°",
      accountDeleted: "ÐÐºÐºÐ°ÑƒÐ½Ñ‚ ÑƒÐ´Ð°Ð»Ñ‘Ð½"
    },
    common: {
      cancel: "ÐžÑ‚Ð¼ÐµÐ½Ð°",
      save: "Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ",
      delete: "Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ",
      confirm: "ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚ÑŒ"
    },
    errors: {
      fillAllFields: "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð·Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð²ÑÐµ Ð¿Ð¾Ð»Ñ.",
      passwordLength: "ÐŸÐ°Ñ€Ð¾Ð»ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð½Ðµ Ð¼ÐµÐ½ÐµÐµ 8 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð².",
      passwordMismatch: "ÐŸÐ°Ñ€Ð¾Ð»Ð¸ Ð½Ðµ ÑÐ¾Ð²Ð¿Ð°Ð´Ð°ÑŽÑ‚!",
      passwordChangeError: "ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑÐ¼ÐµÐ½Ðµ Ð¿Ð°Ñ€Ð¾Ð»Ñ",
      loginError: "ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ñ…Ð¾Ð´Ð°",
      registrationError: "ÐžÑˆÐ¸Ð±ÐºÐ° Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸",
      resetError: "ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ±Ñ€Ð¾ÑÐ° Ð¿Ð°Ñ€Ð¾Ð»Ñ",
      deleteError: "ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð°",
      invalidEmail: "ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ email",
      userNotFound: "ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½",
      wrongPassword: "ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ",
      emailInUse: "Email ÑƒÐ¶Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ",
      networkError: "ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐµÑ‚Ð¸. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ.",
      unknownError: "ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ°. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÐµÑ‰Ñ‘ Ñ€Ð°Ð·."
    }
  },

  en: {
    auth: {
      login: "Login",
      email: "Email",
      password: "Password",
      loginButton: "Sign In",
      noAccount: "No account?",
      register: "Sign Up",
      forgotPassword: "Forgot password?",
      restore: "Reset"
    },
    registration: {
      title: "Sign Up",
      username: "Username",
      email: "Email",
      password: "Password (min 8 characters)",
      confirmPassword: "Confirm Password",
      createAccount: "Create Account",
      haveAccount: "Already have an account?",
      login: "Sign In"
    },
    resetPassword: {
      title: "Forgot Password?",
      description: "No worries! Enter your email and we'll send you a password reset link.",
      email: "Email",
      getCode: "Get Code",
      rememberPassword: "Remember password?",
      login: "Sign In",
      success: "Email sent!"
    },
    newPassword: {
      title: "Reset Password",
      description: "Create a new password to restore access to your account.",
      newPassword: "min 8 characters",
      confirmPassword: "repeat password",
      restore: "Reset Password",
      cancel: "Cancel",
      haveAccount: "Already have an account?",
      login: "Sign In",
      success: "Password Changed",
      successMessage: "Your password has been successfully changed.",
      goToAuth: "Go to Login"
    },
    main: {
      hello: "Hello",
      yourQR: "Your QR Code",
      noPoints: "You don't have any points yet",
      lastUpdate: "Last update",
      rewards: "Rewards received",
      of: "of",
      congratulations: "Congratulations! ðŸŽ‰",
      rewardReceived: "You received a reward at {cafe}!",
      great: "Great!"
    },
    menu: {
      main: "Main",
      settings: "Settings",
      logout: "Logout"
    },
    settings: {
      title: "Settings",
      profile: "Profile",
      changePassword: "Change Password",
      deleteAccount: "Delete Account",
      language: "Language",
      emailLabel: "Email",
      noEmail: "No email",
      changeEmail: "Change email",
      deleteConfirm: "Are you sure you want to delete your account?",
      deleteWarning: "All your data will be permanently deleted. This action cannot be undone.",
      appearance: "Appearance",
      darkTheme: "Dark Theme",
      accountDeleted: "Account deleted"
    },
    common: {
      cancel: "Cancel",
      save: "Save",
      delete: "Delete",
      confirm: "Confirm"
    },
    errors: {
      fillAllFields: "Please fill in all fields.",
      passwordLength: "Password must be at least 8 characters long.",
      passwordMismatch: "Passwords don't match!",
      passwordChangeError: "Password change error",
      loginError: "Login error",
      registrationError: "Registration error",
      resetError: "Password reset error",
      deleteError: "Account deletion error",
      invalidEmail: "Invalid email",
      userNotFound: "User not found",
      wrongPassword: "Wrong password",
      emailInUse: "Email already in use",
      networkError: "Network error. Check your connection.",
      unknownError: "An error occurred. Please try again."
    }
  }
};

// Available languages for UI
export const LANGUAGES = {
  ru: { name: 'Ð ÑƒÑÑÐºÐ¸Ð¹', flag: 'ðŸ‡·ðŸ‡º' },
  en: { name: 'English', flag: 'ðŸ‡¬ðŸ‡§' }
};

// Default language
const DEFAULT_LANGUAGE = 'ru';

// Current language
let currentLanguage = localStorage.getItem('language') || DEFAULT_LANGUAGE;

// Validate language exists, fallback to default
if (!translations[currentLanguage]) {
  currentLanguage = DEFAULT_LANGUAGE;
  localStorage.setItem('language', DEFAULT_LANGUAGE);
}

/**
 * Get translation by key path (e.g., 'auth.login')
 * @param {string} key - Dot-separated key path
 * @param {Object} params - Optional parameters for interpolation
 * @returns {string} Translated string or key if not found
 */
export function t(key, params = {}) {
  const keys = key.split('.');
  let value = translations[currentLanguage];

  for (const k of keys) {
    if (value && value[k] !== undefined) {
      value = value[k];
    } else {
      // Fallback to English if key not found
      value = translations.en;
      for (const fallbackKey of keys) {
        if (value && value[fallbackKey] !== undefined) {
          value = value[fallbackKey];
        } else {
          console.warn(`Translation not found for key: ${key}`);
          return key;
        }
      }
      break;
    }
  }

  // Handle string interpolation {param}
  if (typeof value === 'string' && Object.keys(params).length > 0) {
    return value.replace(/\{(\w+)\}/g, (match, paramName) => {
      return params[paramName] !== undefined ? params[paramName] : match;
    });
  }

  return value;
}

/**
 * Change current language
 * @param {string} lang - Language code ('ru' or 'en')
 */
export function setLanguage(lang) {
  if (translations[lang]) {
    currentLanguage = lang;
    localStorage.setItem('language', lang);
    document.documentElement.lang = lang;
    window.dispatchEvent(new Event('languagechange'));
  } else {
    console.warn(`Language "${lang}" not supported. Available: ${Object.keys(translations).join(', ')}`);
  }
}

/**
 * Get current language code
 * @returns {string}
 */
export function getCurrentLanguage() {
  return currentLanguage;
}

/**
 * Get list of available languages
 * @returns {string[]}
 */
export function getAvailableLanguages() {
  return Object.keys(translations);
}